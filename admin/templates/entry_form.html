{% extends "base.html" %} {% block title %}{{ mode }} Entry{% endblock %} {%
block content %}
<h3>{{ mode }} Knowledge Base Entry</h3>

<form id="entryForm" class="mt-3" enctype="multipart/form-data">
  <div class="mb-3">
    <label class="form-label">Question</label>
    <textarea class="form-control" name="question" rows="2" required>
{{ entry.question if entry }}</textarea
    >
  </div>

  <div class="mb-3">
    <label class="form-label">Answer</label>
    <textarea class="form-control" name="answer" rows="4" required>
{{ entry.answer if entry }}</textarea
    >
  </div>

  <div class="mb-3">
    <label class="form-label">Tags (comma-separated)</label>
    <input
      class="form-control"
      name="tags"
      value="{{ entry.tags | join(',') if entry }}"
    />
  </div>

  <div class="mb-3">
    <label class="form-label">Notes</label>
    <textarea class="form-control" name="notes" rows="2">
{{ entry.notes if entry }}</textarea
    >
  </div>

  <div class="mb-3">
    <label class="form-label">Source File (optional)</label>
    <input type="file" class="form-control" name="file" />
  </div>

  <button class="btn btn-primary" type="submit">Submit</button>
  <a href="/" class="btn btn-secondary">Cancel</a>
</form>

<script>
  document.getElementById("entryForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData(e.target);

    const res = await fetch("{{ submit_url }}", {
      method: "{{ method }}",
      body: formData,
    });

    if (res.ok) {
      alert("Entry saved successfully");

      if (window.opener) {
        window.opener.location.reload();
        window.close();
      } else {
        window.location.href = "/";
      }
    }
  });
</script>
{% endblock %}
